(function(){"use strict";function setDarkMode(enabled){document.documentElement.classList.toggle("dark",enabled);localStorage.setItem("pergament-dark-mode",enabled?"1":"0")}const stored=localStorage.getItem("pergament-dark-mode");if(stored==="1"||stored===null&&window.matchMedia("(prefers-color-scheme: dark)").matches){setDarkMode(true)}const toggle=document.getElementById("dark-mode-toggle");if(toggle){toggle.addEventListener("click",function(){setDarkMode(!document.documentElement.classList.contains("dark"))})}const mobileToggle=document.getElementById("dark-mode-toggle-mobile");if(mobileToggle){mobileToggle.addEventListener("click",function(){setDarkMode(!document.documentElement.classList.contains("dark"))})}const mobileMenuToggle=document.getElementById("mobile-menu-toggle");if(mobileMenuToggle){mobileMenuToggle.addEventListener("click",function(){const menu=document.getElementById("mobile-menu");if(menu)menu.classList.toggle("hidden")})}(function(){const FONT_STEPS=[75,87.5,100,112.5,125,137.5,150];const DEFAULT_IDX=2;const btnDec=document.getElementById("font-size-decrease");const btnInc=document.getElementById("font-size-increase");const btnDecMobile=document.getElementById("font-size-decrease-mobile");const btnIncMobile=document.getElementById("font-size-increase-mobile");if(!btnDec||!btnInc)return;function getCurrentFontIdx(){const val=localStorage.getItem("pergament-font-size");if(!val)return DEFAULT_IDX;const pct=parseFloat(val);const idx=FONT_STEPS.indexOf(pct);return idx>=0?idx:DEFAULT_IDX}function updateButtonStates(idx){const atMin=idx===0;const atMax=idx===FONT_STEPS.length-1;const decTitle=atMin?"You are on the smallest font size":"Decrease font size to "+FONT_STEPS[idx-1]+"%";const incTitle=atMax?"You are on the biggest font size":"Increase font size to "+FONT_STEPS[idx+1]+"%";btnDec.disabled=atMin;btnDec.title=decTitle;btnDec.classList.toggle("opacity-30",atMin);btnDec.classList.toggle("cursor-not-allowed",atMin);btnInc.disabled=atMax;btnInc.title=incTitle;btnInc.classList.toggle("opacity-30",atMax);btnInc.classList.toggle("cursor-not-allowed",atMax);if(btnDecMobile){btnDecMobile.disabled=atMin;btnDecMobile.title=decTitle;btnDecMobile.classList.toggle("opacity-30",atMin);btnDecMobile.classList.toggle("cursor-not-allowed",atMin)}if(btnIncMobile){btnIncMobile.disabled=atMax;btnIncMobile.title=incTitle;btnIncMobile.classList.toggle("opacity-30",atMax);btnIncMobile.classList.toggle("cursor-not-allowed",atMax)}}function applyFontSize(idx){const pct=FONT_STEPS[idx];localStorage.setItem("pergament-font-size",pct);let style=document.getElementById("pergament-font-size-style");if(!style){style=document.createElement("style");style.id="pergament-font-size-style";document.head.appendChild(style)}style.textContent=".prose { font-size: "+pct+"%; }";updateButtonStates(idx)}function decreaseFontSize(){const idx=getCurrentFontIdx();if(idx>0)applyFontSize(idx-1)}function increaseFontSize(){const idx=getCurrentFontIdx();if(idx<FONT_STEPS.length-1)applyFontSize(idx+1)}btnDec.addEventListener("click",decreaseFontSize);btnInc.addEventListener("click",increaseFontSize);if(btnDecMobile)btnDecMobile.addEventListener("click",decreaseFontSize);if(btnIncMobile)btnIncMobile.addEventListener("click",increaseFontSize);updateButtonStates(getCurrentFontIdx())})();(function(){const btn=document.getElementById("dyslexic-toggle");const btnMobile=document.getElementById("dyslexic-toggle-mobile");if(!btn)return;function updateButton(enabled){const title=enabled?"Switch to normal font":"Switch to OpenDyslexic font";btn.title=title;btn.classList.toggle("pergament-active-nav",enabled);if(btnMobile){btnMobile.title=title;btnMobile.classList.toggle("pergament-active-nav",enabled)}}function toggleDyslexic(){const enabled=document.documentElement.classList.toggle("dyslexic");localStorage.setItem("pergament-dyslexic",enabled?"1":"0");updateButton(enabled)}btn.addEventListener("click",toggleDyslexic);if(btnMobile)btnMobile.addEventListener("click",toggleDyslexic);updateButton(document.documentElement.classList.contains("dyslexic"))})();(function(){const overlay=document.createElement("div");overlay.className="pergament-lightbox";const lightboxImg=document.createElement("img");overlay.appendChild(lightboxImg);document.body.appendChild(overlay);function open(src,alt){lightboxImg.src=src;lightboxImg.alt=alt||"";overlay.classList.add("is-open");document.body.classList.add("lightbox-open")}function close(){overlay.classList.remove("is-open");document.body.classList.remove("lightbox-open")}overlay.addEventListener("click",close);document.addEventListener("keydown",function(e){if(e.key==="Escape")close()});document.querySelectorAll("main img:not(.rounded-full)").forEach(function(img){img.classList.add("pergament-zoomable");img.addEventListener("click",function(e){e.stopPropagation();open(img.src,img.alt)})})})();(function(){const copySvg='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>';const checkSvg='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';document.querySelectorAll("main pre").forEach(function(pre){const btn=document.createElement("button");btn.className="copy-code-btn";btn.setAttribute("aria-label","Copy code to clipboard");btn.innerHTML=copySvg;btn.addEventListener("click",function(){const code=pre.querySelector("code");const text=code?code.innerText:pre.innerText;navigator.clipboard.writeText(text).then(function(){btn.innerHTML=checkSvg;setTimeout(function(){btn.innerHTML=copySvg},2e3)})});pre.appendChild(btn)})})();(function(){const backdrop=document.getElementById("cmd-palette-backdrop");const input=document.getElementById("cmd-palette-input");const resultsEl=document.getElementById("cmd-palette-results");if(!backdrop||!input||!resultsEl)return;const searchUrl=window.PergamentConfig&&window.PergamentConfig.searchUrl||null;if(!searchUrl)return;let activeIdx=-1;let results=[];let debounce=null;function open(){backdrop.classList.add("is-open");document.body.classList.add("cmd-open");input.value="";resultsEl.innerHTML="";results=[];activeIdx=-1;setTimeout(function(){input.focus()},30)}function close(){backdrop.classList.remove("is-open");document.body.classList.remove("cmd-open")}function setActive(idx){const items=resultsEl.querySelectorAll(".pergament-cmd-result");items.forEach(function(el,i){el.classList.toggle("is-active",i===idx)});activeIdx=idx;if(idx>=0&&items[idx]){items[idx].scrollIntoView({block:"nearest"})}}function navigate(){if(activeIdx>=0&&results[activeIdx]){window.location.href=results[activeIdx].url;close()}}function typeLabel(type){if(type==="doc")return"Doc";if(type==="post")return"Post";if(type==="page")return"Page";return type.charAt(0).toUpperCase()+type.slice(1)}function render(data){results=data;activeIdx=-1;resultsEl.innerHTML="";if(data.length===0){const empty=document.createElement("p");empty.className="pergament-cmd-empty";empty.textContent="No results found.";resultsEl.appendChild(empty);return}data.forEach(function(result,i){const a=document.createElement("a");a.href=result.url;a.className="pergament-cmd-result";a.setAttribute("role","option");const badge=document.createElement("span");badge.className="pergament-cmd-result-badge";badge.textContent=typeLabel(result.type);const body=document.createElement("div");body.className="pergament-cmd-result-body";const title=document.createElement("div");title.className="pergament-cmd-result-title";title.textContent=result.title;body.appendChild(title);if(result.excerpt){const excerpt=document.createElement("div");excerpt.className="pergament-cmd-result-excerpt";excerpt.textContent=result.excerpt;body.appendChild(excerpt)}a.appendChild(badge);a.appendChild(body);a.addEventListener("mouseenter",function(){setActive(i)});a.addEventListener("click",function(e){e.preventDefault();window.location.href=result.url;close()});resultsEl.appendChild(a)})}function doSearch(q){if(q.length<2){resultsEl.innerHTML="";results=[];return}fetch(searchUrl+"?q="+encodeURIComponent(q),{headers:{"Accept":"application/json","X-Requested-With":"XMLHttpRequest"}}).then(function(r){return r.json()}).then(render).catch(function(){})}input.addEventListener("input",function(){clearTimeout(debounce);debounce=setTimeout(function(){doSearch(input.value.trim())},200)});input.addEventListener("keydown",function(e){const items=resultsEl.querySelectorAll(".pergament-cmd-result");if(e.key==="ArrowDown"){e.preventDefault();setActive(Math.min(activeIdx+1,items.length-1))}else if(e.key==="ArrowUp"){e.preventDefault();setActive(Math.max(activeIdx-1,0))}else if(e.key==="Enter"){e.preventDefault();navigate()}else if(e.key==="Escape"){close()}});backdrop.addEventListener("click",function(e){if(e.target===backdrop)close()});document.addEventListener("keydown",function(e){if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault();backdrop.classList.contains("is-open")?close():open()}});document.querySelectorAll('input[name="q"]').forEach(function(navInput){navInput.addEventListener("mousedown",function(e){e.preventDefault();open()});navInput.addEventListener("focus",function(){navInput.blur();open()})})})();(function(){if(!("serviceWorker"in navigator))return;const swUrl=window.PergamentConfig&&window.PergamentConfig.swUrl;if(!swUrl)return;navigator.serviceWorker.register(swUrl)})();(function(){const toggle2=document.getElementById("docs-sidebar-toggle");if(!toggle2)return;toggle2.addEventListener("click",function(){const sidebar=document.getElementById("docs-sidebar");if(sidebar)sidebar.classList.toggle("hidden")})})();(function(){const tocLinks=Array.from(document.querySelectorAll("[data-toc-link]"));if(!tocLinks.length)return;const headings=Array.from(document.querySelectorAll(".prose h2[id], .prose h3[id], .prose h4[id]"));if(!headings.length)return;const visibleIds=new Set;function activate(id){tocLinks.forEach(function(link){const isActive=link.dataset.tocLink===id;link.classList.toggle("toc-link-active",isActive);if(isActive){link.scrollIntoView({block:"nearest"})}})}function update(){for(let i=0;i<headings.length;i++){if(visibleIds.has(headings[i].id)){activate(headings[i].id);return}}var cutoff=window.scrollY+100;var candidate=null;headings.forEach(function(h){if(h.offsetTop<=cutoff)candidate=h.id});if(candidate)activate(candidate)}const observer=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.isIntersecting){visibleIds.add(entry.target.id)}else{visibleIds.delete(entry.target.id)}});update()},{rootMargin:"-80px 0px -40% 0px",threshold:0});headings.forEach(function(h){observer.observe(h)})})();(function(){const pilcrowSvg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M13 4v16M17 4v16M19 4H9.5a4.5 4.5 0 0 0 0 9H13"/></svg>';const checkSvg2='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';document.querySelectorAll(".prose h2[id], .prose h3[id], .prose h4[id]").forEach(function(heading){const btn=document.createElement("button");btn.className="heading-anchor";btn.setAttribute("aria-label","Copy link to section");btn.innerHTML=pilcrowSvg;btn.addEventListener("click",function(e){e.stopPropagation();const url=window.location.origin+window.location.pathname+"#"+heading.id;navigator.clipboard.writeText(url).then(function(){btn.innerHTML=checkSvg2;setTimeout(function(){btn.innerHTML=pilcrowSvg},2e3)})});heading.appendChild(btn)})})()})();
